services:
  app:
    build:
      context: .
      dockerfile: Dockerfile # Dockerfile Multi-stage
      target: app_prod
    container_name: laravel_date_app
    networks:
      - laravel_date_network
      - db_shared_network # Red para hablar con DB compartida
    env_file:
      - .env
    restart: always

  web:
    build:
      context: .
      dockerfile: Dockerfile
      target: web_prod
    container_name: laravel_date_web
    ports:
      - "8004:80"
    networks:
      - laravel_date_network
    depends_on:
      - app
    restart: always

# Definici√≥n de redes
networks:
  laravel_date_network:
    driver: bridge
  # Red externa para conectar con contenedor de MySQL existente
  db_shared_network:
    external: true
    name: shared_services_network
